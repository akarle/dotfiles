#!/bin/sh
# plumb -- plumber for tmux's copy-pipe
# reads the item to plumb from stdin, optionally takes a working dir
# and arguments for split-window (i.e. to split above or set size)
read ITEM

if [ -n "$1" ]; then
	cd "$1"
fi
shift

# only accept first argument (by whitespace)
ITEM=$(echo "$ITEM" | awk '{ print $1 }')

case "$ITEM" in
	http*) firefox "$ITEM" ;;
	[a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9]*) \
		tmux split-window "$@" sh -c "git show $ITEM 2>&1 | less" ;;
	[a-zA-Z0-9.]*:[0-9]*:*) tmux split-window "$@" sh -c "fned \"$ITEM\"" ;;
	*) tmux split-window "$@" sh -c "vi $ITEM" ;;
esac
